<?php
class ChanakyaString
{
	var $array_one;
	var $array_two;
	var $array_three;
	var $array_forth;
	function __construct()
	{
		$this->array_one = array(
	/*1 */	"¤","U","ú","¡ê","¡é"," ",".",",","—","/",
	/*2 */	"¢ğ","´ğ","¢¸","ğ¸","ğğ","¢¢","ï","ğş","Ñ","ğı","ñı","¢ş","¡¡",
	/*3 */	"¥æò","¸",
	/*4 */	"•¸", "¹¸", "»¸", "Á¸","Ç¸", "É¸", "È¸","Ø¸","Ú¸",
	/*5 */	"A","B","C","D","E","F","G","H","I","J","K","L","M",
	/*6 */	"N","O","P","Q","R","T","V","W","X","Y",
	/*7 */	"`","a","b","d","e","f","g","h","i","j","k","l","m","n","p","q","r","s","t","u","_",  
	/*8 */	"æ","","#","%","@",
	/*9 */	"„","¦","¨","¯","µ","º",
	/*10 */	"Cş","q","Ê","u","g",    
	/*11 */	"Ÿæ","Åş","Çş","Éş","Uæ",
	/*12 */	"^","h","Ğ","ı","ş",
	/*13 */	"¥ô","¥æğ","¥õ","¥æñ","¥æ","¥","§Z","§ü","§","©","ª","«","¬","­","°ğ","°",
	/*14 */	"€", "·", "",  "¹", "‚", "»", "ƒæ", "ƒ", "¾", 
	/*15 */	"“","‘","¿","À","”","…","’","Á","Ûæ","Û","†æ","†",
	/*16 */	"Å","Æ","Ç","É","‡æ","‡",
	/*17 */	"ˆ","Ì","‰","Í","Î","¼","Š","Ï","óæ","ó","‹æ","Ù","‹",
	/*18 */	"Œ","Â","","È","","Õ","","Ö","","×",
	/*19 */	"Ä","Ø","Ú","Ë","Ü","¶","İ","Ã","ß",
	/*20 */	"àæ","³æ","o","³","à","c","á","S","â","ã","±",
	/*21 */	"ÿæ","ÿ","˜æ","˜","™æ","™","üğ´",
	/*22 */	"æò","æñ","æ","è","é","ê","ä","å","ë","ì","í","Ô","ñ","ô","õ",
	/*23 */	"¢","´","¡","Ñ","¸","ò","ù","÷","ğ",
	/*24 */	"0","1","2","3","4","5","6","7","8","9",
	/*25 */	"®","v","w","x","y","z","{","|","}","~","ü","ç","\r","\n","\t","}æ","Øæ",
	/*26 */	"??","??","???", "???","??","??","??","??","??","??","??","??","???",
	/*27 */ "(",")","Ò","Ó");
	
	
		$this->array_two = array(
	/*1 */	"", "","à¥","ÃªÂ¡","Ã©Â¡"," ",".",",","-","/",
	/*2 */	"Ã°Â¢", "Ã°Â´","Â¸Â¢","Â¸Ã°","Ã°","Â¢","","Ã¾Ã°","à¤ƒ","Ã½Ã°","Ã½Ã±","Ã¾Â¢","Â¡",
	/*3 */	"à¤‘", "à¥à¥",
	/*4 */	"à¥˜","à¥™","à¥š","à¥›","à¥œ","à¥","à¥","à¥Ÿ","à¤±",
	/*5 */	"à¥à¤°","à¤•à¥à¤š","à¤·à¥à¤Ÿ","à¤·à¥à¤ ","à¤¶à¥à¤µ","à¤¸à¥à¤¨","à¤¤à¥à¤°","à¥¥","à¤¢à¥à¤¢","à¤›à¥à¤µ","à¥à¤¯","à¤°à¥","à¤°à¥‚",
	/*6 */	"à¤¹à¥ƒ","à¤¹à¥à¤°","à¤•à¥à¤•","à¤•à¥à¤¤","à¤•à¥à¤°","à¤à¥à¤œ","à¤™à¥à¤•","à¤™à¥à¤–","à¤™à¥à¤—","à¤™à¥à¤˜",
	/*7 */	"à¤•à¥à¤µ","à¤¡à¥à¤¡","à¤¡à¥à¤¢","à¤¸à¥à¤°","à¤¦à¥à¤—","à¤¦à¥à¤˜","à¤¦à¥à¤¦","à¤¦à¥à¤§","à¤¦à¥à¤¬","à¤¦à¥à¤­","à¤¦à¥à¤®","à¤¦à¥à¤¯","à¤¦à¥à¤µ","à¤ à¥à¤ ","à¤¶à¥à¤š","à¤¹à¥à¤¨","à¤¹à¥à¤®à¥","à¤¹à¥à¤¯","à¤¹à¥à¤²","à¤¹à¥à¤µ","à¤Ÿà¥à¤ ", 
	/*8 */	"à¤¤à¥à¤¤","à¤¤à¥à¤¤à¥","à¤ªà¥à¤¤","à¤¤à¥à¤¨","à¤à¥à¤š",
	/*9 */	"à¤²à¥à¤²","à¤·à¥à¤Ÿà¥à¤µ","à¤¿à¤‚","à¤–à¥à¤¨","à¤¦à¥à¤¬à¥à¤°","à¤–à¥à¤°",
	/*10 */	"à¤·à¥à¤Ÿà¥à¤°","à¤¹à¥à¤¨","à¤œà¤¼à¥","à¤¹à¥à¤µ","à¤¦à¥à¤¦",  
	/*11 */	"à¤¶à¥à¤°","à¤Ÿà¥à¤°","à¤¡à¥à¤°","à¤¢à¥à¤°","à¤¾",
	/*12 */	"à¤Ÿà¥à¤Ÿ","à¤¦à¥à¤§","à¥¤","à¥à¤°","à¥à¤°",
	/*13 */	"à¤“","à¤“","à¤”","à¤”","à¤†","à¤…","à¤ˆà¤‚","à¤ˆ","à¤‡","à¤‰","à¤Š","à¤‹","à¥ ","à¤Œ","à¤","à¤",
	/*14 */	"à¤•à¥", "à¤•","à¤–à¥","à¤–","à¤—à¥","à¤—","à¤˜","à¤˜à¥","à¤™",
	/*15 */	"à¤šà¥à¤šà¥","à¤šà¥","à¤š","à¤›","à¤œà¥à¤œà¥","à¤œà¥","à¤œà¥","à¤œ","à¤","à¤à¥","à¤","à¤à¥",
	/*16 */	"à¤Ÿ","à¤ ","à¤¡","à¤¢","à¤£","à¤£à¥",
	/*17 */	"à¤¤à¥","à¤¤","à¤¥à¥","à¤¥","à¤¦","à¤¦","à¤§à¥","à¤§","à¤¨à¥à¤¨","à¤¨à¥à¤¨à¥","à¤¨","à¤¨","à¤¨à¥",
	/*18 */	"à¤ªà¥","à¤ª","à¤«à¥","à¤«","à¤¬à¥","à¤¬","à¤­à¥","à¤­","à¤®à¥","à¤®",
	/*19 */	"à¤¯à¥","à¤¯","à¤°","à¤²à¥","à¤²","à¤²","à¤³","à¤µà¥","à¤µ",
	/*20 */	"à¤¶","à¤¶","à¤¶à¥ƒ","à¤¶à¥","à¤¶à¥","à¤·à¥","à¤·","à¤¸à¥","à¤¸","à¤¹","à¤¹à¥",
	/*21 */	"à¤•à¥à¤·","à¤•à¥à¤·à¥","à¤¤à¥à¤°","à¤¤à¥à¤°à¥","à¤œà¥à¤","à¤œà¥à¤à¥","Ã°Z",
	/*22 */	"à¥‰","à¥Œ","à¤¾","à¥€","à¥","à¥‚","à¥","à¥‚","à¥ƒ","à¥„","à¥¢","à¥‡","à¥ˆ","à¥‹","à¥Œ",
	/*23 */	"à¤‚","à¤‚","à¤",":","à¤¼", "à¥…","à¤½","à¥","à¥‡",
	/*24 */	"à¥¦","à¥§","à¥¨","à¥©","à¥ª","à¥«","à¥¬","à¥­","à¥®","à¥¯",
	/*25 */	"0","à¤•à¥","à¤–à¥","à¤«à¥","à¤¬à¥","à¤­à¥","à¤®à¥","à¤¸à¥à¤¤à¥à¤°","à¤¤à¥à¤¤à¥","-","à¤°à¥","à¤¿","\r","\n","\t","à¤¤à¥à¤¤","à¤¯",
	/*26 */	"à¥‡", "à¥ˆ", "à¥‡","à¤¾","à¥‹","à¥‹","à¥Œ","","à¥à¤‚","à¤“","à¥‹","à¥‹","à¤ˆà¤‚",
	/*27 */ "(",")","'","'");
	
		$this->matra = array("æ","ç","è","é","ê","ğ","ñ","ô","õ","´","ü");
		$this->halfChar = array("‚","ƒ","‘","…","’","“","”","Û","†","‡","ˆ","‰","Š","ó","‹","Œ","","Ä","Ë","Ã","o","³","à","c","S","±","ÿ","˜","™","v","w","x","y","z","{","}","Ÿ");
	
		$this->array_three = array("c","o","r","v","w","y","z","{","}","‚","ƒ","…","†","ˆ","‰","Š","‹","Œ","‘","’","“","”","•","˜","™","Ÿ","±","³","²","Ä","Ê","Ë","Û","à","ó","æ","‡");
		
		$this->array_three = array("c","o","r","v","w","y","z","{","}","‚","ƒ","…","†","ˆ","‰","Š","‹","Œ","‘","’","“","”","•","˜","™","Ÿ","±","³","²","Ä","Ê","Ë","Û","à","ó","æ","‡","ÿæ","ÿ","˜æ","˜","™æ","™","üğ´","æò","æñ","è","é","ê","ä","å","ë","ì","í","Ô","ñ","ô","õ","¢ğ","´ğ","¢¸","ğ¸","ğğ","¢¢","ï","ğş","Ñ","ğı","ñı","¢ş","¡¡","¢","´","¡","Ñ","¸","ò","ù","÷","ğ");
		
		$this->array_forth = array("c","o","r","v","w","y","z","{","}","‚","ƒ","…","†","ˆ","‰","Š","‹","Œ","‘","’","“","”","•","˜","™","Ÿ","±","³","²","Ä","Ê","Ë","Û","à","ó","‡","ü");
	}
	function isMatra($ch)
	{
		if(array_search($ch,$this->matra)===false)
		{
			return false;
		}
		else
		{
			return true;
		}
	}
	function isHalfChar($ch)
	{
		if(array_search($ch,$this->halfChar)===false)
		{
			return false;
		}
		else
		{
			return true;
		}
	}
	private function findPosition($str,$k,$p=0)
	{
		$t = 0;
		for($i=0;$i<strlen($str);$i++)
		{
			//echo  $str[$i]."..".$k."<br>";
			if($str[$i]==$k)
			{
				if($p==$t)
				{
					return $i;
				}
				$t++;
			}
		}
		return -1;
	}
	function getLastChar($str,$utf=false)
	{
		$l = strlen($str);
		if($utf)
		{
			return substr($str,$l-4,3);
		}
		else
		{
			return $str[$l-1];
		}
	}
	function removeLastChar($str,$utf=true)
	{
		$l = strlen($str);
		if($utf)
		{
			return substr($str,0,$l-4);
		}
		else
		{
			return substr($str,0,$l-2);
		}
	}
	function toUTF8($str,$webBreak=false)
	{
		$out = "";
		$l = strlen($str);
		
		$pos = 0;
		$str = str_replace("oæë","o",$str);
		$str = str_replace("·ı","R",$str);
		$str = str_replace("æò","òæ",$str);

		
		for($i=0;$i<strlen($str);$i++)
		{
			if($str[$i]=="´" && array_search($str[$i+1],$this->matra)!==false)
			{
				
				$str[$i] = $str[$i+1];
				$str[$i+1]="´";
				
			}
			if($str[$i]=="¨")
			{
				if(array_search($str[$i+1],$this->matra)===false 
				|| array_search($str[$i+1],$this->halfChar)===false)
				{
					$str[$i]="ç";
					//$str[$i+2]="ï"+$str[$i+2];
				}
				
			}
		}
		
		$p = $this->findPosition($str,"ü",$pos);
		while($p>=0)
		{
			$ip = 0;


			while($this->isHalfChar($str[$p-$ip-1]) || $this->isMatra($str[$p-$ip-1]))
			{
				if($str[$p-$ip-1]=="æ" && $this->isHalfChar($str[$p-$ip-2]))
				{
					
					$t = $str[$p-$ip];
					$str[$p-$ip] = $str[$p-$ip-1];
					$str[$p-$ip-1]=$t;
					$ip++;
					break;
				}
				if($p-$ip-1>=0)
				{
					$t = $str[$p-$ip];
					$str[$p-$ip] = $str[$p-$ip-1];
					$str[$p-$ip-1]=$t;
					$ip++;
					//echo $ip;
				}
				else
				{
					break;
				}
				
			}
			
			$t = $str[$p-$ip];
			$str[$p-$ip] = $str[$p-$ip-1];
			$str[$p-$ip-1]=$t;
			$ip++;
			
			$pos++;
			$p = $this->findPosition($str,"ü",$pos);
		}
		
		$str = str_replace("çü","üç",$str);
		//echo $str."<br>";
		
		
		$pos = 0;
		$p = $this->findPosition($str,"ç",$pos);
		
		while($p>=0)
		{
			
			$ip = 0;


			while($this->isHalfChar($str[$p+$ip+1]) || $this->isMatra($str[$p+$ip+1]))
			{
				/*
				if($str[$p+$ip+1]=="ü")
				{
					$t = $str[$p+$ip];
					$str[$p+$ip] = $str[$p+$ip+1];
					$str[$p+$ip+1]=$t;
					$ip++;
				
				}	
				
				if($str[$p+$ip+1]=="æ")
				{
					
					$t = $str[$p+$ip];
					$str[$p+$ip] = $str[$p+$ip+1];
					$str[$p+$ip+1]=$t;
					$ip++;
					break;
				}
				*/
								
				if($p-$ip+1>=strlen($str))
				{
					$t = $str[$p+$ip];
					$str[$p+$ip] = $str[$p+$ip+1];
					$str[$p+$ip+1]=$t;
					$ip++;
					//echo $ip;
				}
				else
				{
					$t = $str[$p+$ip];
					$str[$p+$ip] = $str[$p+$ip+1];
					$str[$p+$ip+1]=$t;
					$ip++;
					break;
				}
				
			}
			
			$t = $str[$p+$ip];
			$str[$p+$ip] = $str[$p+$ip+1];
			$str[$p+$ip+1]=$t;
			$ip++;
			
			
			$pos++;
			$p = $this->findPosition($str,"ç",$pos);
		}
		
		//echo $str."<br>";
		$str = str_replace("çæ","æç",$str);
		$l = strlen($str);
		for($i=0;$i<$l;$i++)
		{
			$ch = $str[$i];
			if($i<$l-1 && $str[$i+1]=="æ" && $str[$i]!="ç" && $this->isHalfChar($ch))
			{
				$ch.="æ";
				$i++;
			}
			
			
			$p = array_search($ch,$this->array_one);
			
			//echo "$ch..$p..".$this->array_two[$p]."<br>\r\n";
			
			
			if($this->isMatra($ch) && $this->getLastChar($out,true)=="à¥")
			{
				$this->removeLastChar($out,true);
			}
			
			
			$out.= $this->array_two[$p];
			//echo "<br>";
			//$str = str_replace($this->array_one[$i],$this->array_tow[$i],$str);
		}
		$out = str_replace("à¥à¤¾","",$out);
		
		$out = str_replace("à¤¾à¥‡","à¥‹",$out);
		$out = str_replace("à¤¾à¥ˆ","à¥Œ",$out);
		$out = str_replace("à¤…à¤¾","à¤†",$out);
		$out = str_replace("à¤…à¥‹","à¤“",$out);
		$out = str_replace("à¤…à¥Œ","à¤”",$out);
		$out = str_replace("à¤à¥‡","à¤",$out);
		$out = str_replace("''",'"',$out);
		$out = str_replace(" à¤ƒ "," : ",$out);
		if($webBreak)
		{
			return str_replace("\r\n","<br>\r\n",$out);		
		}
		else
		{
			return $out;
		}
	}
}
?>